#!/bin/sh

autogen () {
	# autogen command(s)
	autoreconf -i -f
}

# force the deletion of these files and/or directories
#forcedelete="some-file1.ext some-file2.ext some/directory/"

cleanscript="autogen-cleanup.sh"

if [ -f $cleanscript ]; then
	echo "warning: autogen clean-up script found!"
	echo "run \`./$cleanscript' first"
	exit 1
fi

find . > .autogen_sh_before
autogen
find . > .autogen_sh_after
diff -u .autogen_sh_before .autogen_sh_after | grep '^+\./' | sed 's|^+||g' | \
	grep -v '^\.\/git\/' | \
	grep -v '^\.\/hg\/' | \
	grep -v '^\.\/svn\/' | \
	grep -v '^\.\/bzr\/' | \
	grep -v '^\.\/\.autogen_sh_' > .autogen_sh_files

cat <<EOF> $cleanscript
#!/bin/sh
# this script was automatically generated by $(basename $0)
if [ -f Makefile ] || [ -f GNUmakefile ]; then
	(make maintainer-clean 2>/dev/null || 
	 make distclean 2>/dev/null || 
	 make clean 2>/dev/null) || true
fi
set -v
EOF

chmod a+x $cleanscript

for f in $(tac .autogen_sh_files); do
	if [ -d $f ]; then
		echo "rmdir $f 2>/dev/null || true" >> $cleanscript
	else
		echo "rm -f $f" >> $cleanscript
	fi
done
echo "rm -rf $forcedelete" >> $cleanscript
echo "rm -f $cleanscript" >> $cleanscript

rm -f .autogen_sh_before .autogen_sh_after .autogen_sh_files

